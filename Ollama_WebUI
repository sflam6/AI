# Install Ollama
curl -fsSL https://ollama.com/install.sh | sh

# create docker environment
mkdir OllamaDocker
cd OllamaDocker

# Write config file for docker
#!/bin/bash

# Define the target directory and filename
TARGET_DIR=~/OllamDocker
TARGET_FILE=${TARGET_DIR}/docker-compose.yml

# Create the target directory if it doesn't exist
mkdir -p "$TARGET_DIR"

# One big sed command to insert content line by line
sed -e '1i\version: '"'"'3.8'"'"'\n' \
    -e '2i\nservices:' \
    -e '3a\tollama:' \
    -e '4a\t\tvolumes:' \
    -e '5a\t\t\t- ./ollama/ollama:/root/.ollama' \
    -e '6a\t\tcontainer_name: ollama' \
    -e '7a\t\tpull_policy: always' \
    -e '8a\t\tty: true' \
    -e '9a\t\trestart: unless-stopped' \
    -e '10a\t\timage: ollama/ollama:latest' \
    -e '11a\t\tports:' \
    -e '12a\t\t\t- 11434:11434' \
    -e '13a\t\tnetworks:' \
    -e '14a\t\t\t- ollama-docker' \
    -e '15a\t\tdeploy:' \
    -e '16a\t\t\tresources:' \
    -e '17a\t\t\t\treservations:' \
    -e '18a\t\t\t\t\tdevices:' \
    -e '19a\t\t\t\t\t\t- driver: nvidia' \
    -e '20a\t\t\t\t\t\t  count: 1' \
    -e '21a\t\t\t\t\t\t  capabilities: [gpu]'  \
    > "$TARGET_FILE"

echo "docker-compose.yml created in $TARGET_FILE"
